[
  {
    "objectID": "index.html#overview",
    "href": "index.html#overview",
    "title": "",
    "section": "Overview",
    "text": "Overview\nThis report provides a reproducible pipeline for processing DATASUS annual population estimates by municipality, age, and sex in Brazil.\nFor instructions on how to run the pipeline, see the repository README."
  },
  {
    "objectID": "index.html#problem",
    "href": "index.html#problem",
    "title": "",
    "section": "Problem",
    "text": "Problem\nAccurate population estimates are fundamental for public health planning, resource allocation, and demographic research. The Department of Informatics of the Brazilian Unified Health System (DATASUS) publishes annual population estimates by municipality, age, and sex for Brazil. While these datasets are comprehensive, they require some processing to be directly usable for analysis in R. This pipeline provides a reproducible workflow to download and structure the data, enabling efficient and reliable downstream analyses."
  },
  {
    "objectID": "index.html#data-availability",
    "href": "index.html#data-availability",
    "title": "",
    "section": "Data Availability",
    "text": "Data Availability\n\n\n\nThe processed data are available in csv, rds, and parquet formats via a dedicated repository on the Open Science Framework (OSF), accessible here. Each dataset is accompanied by a metadata file describing its structure and contents.\nYou can also retrieve these files directly from R using the osfr package."
  },
  {
    "objectID": "index.html#methods",
    "href": "index.html#methods",
    "title": "",
    "section": "Methods",
    "text": "Methods\nSource of Data\nThe data used in this report come from the following sources:\n\nDepartment of Informatics of the Brazilian Unified Health System (DATASUS):\n\nAnnual population estimates by municipality, age, and sex for Brazil (Comitê de Gestão de Indicadores et al., n.d.), the primary dataset for this pipeline.\n\n\nData Munging\nThe data munging follow the data science workflow outlined by Wickham et al. (2023), as illustrated in Figure 1. All processes were made using the Quarto publishing system (Allaire et al., n.d.), the R programming language (R Core Team, n.d.) and several R packages.\nFor data manipulation and workflow, priority was given to packages from the tidyverse, rOpenSci and r-spatial ecosystems, as well as other packages adhering to the tidy tools manifesto (Wickham, 2023).\n\n\nFigure 1: Data science workflow created by Wickham, Çetinkaya-Runde, and Grolemund.\n\n\nSource: Reproduced from Wickham et al. (2023).\n\n\n\nCode Style\nThe Tidyverse Tidy Tools Manifesto (Wickham, 2023), code style guide (Wickham, n.d.-a) and design principles (Wickham, n.d.-b) were followed to ensure consistency and enhance readability.\nReproducibility\nThe pipeline is fully reproducible and can be run again at any time. To ensure consistent results, the renv package (Ushey & Wickham, n.d.) is used to manage and restore the R environment. See the README file in the code repository to learn how to run it."
  },
  {
    "objectID": "index.html#set-environment",
    "href": "index.html#set-environment",
    "title": "",
    "section": "Set Environment",
    "text": "Set Environment\nLoad Packages\n\nlibrary(brandr)\nlibrary(cli)\nlibrary(dplyr)\nlibrary(foreign)\nlibrary(fs)\nlibrary(geobr)\nlibrary(ggplot2)\nlibrary(ggspatial)\nlibrary(here)\nlibrary(htmltools)\nlibrary(httr2)\nlibrary(janitor)\nlibrary(labelled)\nlibrary(nanoparquet)\nlibrary(orbis) # github.com/danielvartan/orbis\nlibrary(osfr)\nlibrary(readr)\nlibrary(sf)\nlibrary(stringr)\nlibrary(tidyr)\nlibrary(zip)\n\nSet Data Directories\n\nraw_data_dir &lt;- here(\"data-raw\")\ndata_dir &lt;- here(\"data\")\n\n\nfor (i in c(raw_data_dir, data_dir)) {\n  if (!dir_exists(i)) dir_create(i, recurse = TRUE)\n}\n\nSet Initial Variables\n\n\n\n\n\n\nThe year variable represent the year of the consolidated DATASUS dataset. Click here to see the available years.\n\n\n\n\nyear &lt;- 2025"
  },
  {
    "objectID": "index.html#download-data",
    "href": "index.html#download-data",
    "title": "",
    "section": "Download Data",
    "text": "Download Data\n\n\n\n\n\n\nSee the Source of Data section for more information.\n\n\n\nGet Data\n\nfile &lt;-\n  \"POPSBR\" |&gt;\n  paste0(str_sub(year, 3, 4), \".zip\")\n\n\n\"ftp.datasus.gov.br\" |&gt;\n  path(\n    \"dissemin\",\n    \"publicos\",\n    \"IBGE\",\n    \"POPSVS\",\n    file\n  ) |&gt;\n  request() |&gt;\n  req_progress() |&gt;\n  req_perform(here(raw_data_dir, file))\n\nUnzip Data\n\nhere(raw_data_dir, file) |&gt;\n  unzip(exdir = raw_data_dir)\n\n\nfile &lt;-\n  raw_data_dir |&gt;\n  dir_ls(\n    type = \"file\",\n    regexp = paste0(str_sub(year, 3, 4), \"\\\\.dbf$\")\n  ) |&gt;\n  basename()\n\nDelete Zip Files\n\nraw_data_dir |&gt;\n  dir_ls(\n    type = \"file\",\n    regexp = \"\\\\.zip$\"\n  ) |&gt;\n  file_delete()"
  },
  {
    "objectID": "index.html#import-data",
    "href": "index.html#import-data",
    "title": "",
    "section": "Import Data",
    "text": "Import Data\n\ndata &lt;-\n  raw_data_dir |&gt;\n  here(file) |&gt;\n  read.dbf() |&gt;\n  as_tibble()\n\n\ndata |&gt; glimpse()\n#&gt; Rows: 902,502\n#&gt; Columns: 5\n#&gt; $ cod_mun &lt;fct&gt; 1100015, 1100023, 1100031, 1100049, 1100056, 1100064, 11000…\n#&gt; $ ano     &lt;fct&gt; 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2025,…\n#&gt; $ sexo    &lt;fct&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…\n#&gt; $ idade   &lt;fct&gt; 000, 000, 000, 000, 000, 000, 000, 000, 000, 000, 000, 000,…\n#&gt; $ pop     &lt;int&gt; 148, 732, 31, 640, 112, 86, 48, 103, 221, 362, 368, 934, 24…"
  },
  {
    "objectID": "index.html#tidy-data",
    "href": "index.html#tidy-data",
    "title": "",
    "section": "Tidy Data",
    "text": "Tidy Data\nRename Columns\n\ndata &lt;-\n  data |&gt;\n  clean_names() |&gt;\n  rename(\n    municipality_code = cod_mun,\n    year = ano,\n    sex = sexo,\n    age = idade,\n    population = pop\n  )\n\n\ndata |&gt; glimpse()\n#&gt; Rows: 902,502\n#&gt; Columns: 5\n#&gt; $ municipality_code &lt;fct&gt; 1100015, 1100023, 1100031, 1100049, 1100056, 1100…\n#&gt; $ year              &lt;fct&gt; 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2…\n#&gt; $ sex               &lt;fct&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n#&gt; $ age               &lt;fct&gt; 000, 000, 000, 000, 000, 000, 000, 000, 000, 000,…\n#&gt; $ population        &lt;int&gt; 148, 732, 31, 640, 112, 86, 48, 103, 221, 362, 36…\n\nStandardize Columns\n\ndata &lt;-\n  data |&gt;\n  mutate(\n    across(\n      .cols = where(is.factor),\n      .fns = \\(x) x |&gt; as.character() |&gt; as.integer()\n    )\n  ) |&gt;\n  mutate(\n    sex = sex |&gt;\n      factor(\n        levels = 1:2,\n        labels = c(\"male\", \"female\"),\n        ordered = FALSE\n      )\n  )\n\n\ndata |&gt; glimpse()\n#&gt; Rows: 902,502\n#&gt; Columns: 5\n#&gt; $ municipality_code &lt;int&gt; 1100015, 1100023, 1100031, 1100049, 1100056, 1100…\n#&gt; $ year              &lt;int&gt; 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2…\n#&gt; $ sex               &lt;fct&gt; male, male, male, male, male, male, male, male, m…\n#&gt; $ age               &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n#&gt; $ population        &lt;int&gt; 148, 732, 31, 640, 112, 86, 48, 103, 221, 362, 36…\n\nRelocate Columns\n\ndata &lt;- data |&gt; relocate(year)\n\n\ndata |&gt; glimpse()\n#&gt; Rows: 902,502\n#&gt; Columns: 5\n#&gt; $ year              &lt;int&gt; 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2…\n#&gt; $ municipality_code &lt;int&gt; 1100015, 1100023, 1100031, 1100049, 1100056, 1100…\n#&gt; $ sex               &lt;fct&gt; male, male, male, male, male, male, male, male, m…\n#&gt; $ age               &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…\n#&gt; $ population        &lt;int&gt; 148, 732, 31, 640, 112, 86, 48, 103, 221, 362, 36…\n\nArrange Data\n\ndata &lt;-\n  data |&gt;\n  arrange(\n    year,\n    municipality_code,\n    sex,\n    age\n  )\n\n\ndata |&gt; glimpse()\n#&gt; Rows: 902,502\n#&gt; Columns: 5\n#&gt; $ year              &lt;int&gt; 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2…\n#&gt; $ municipality_code &lt;int&gt; 1100015, 1100015, 1100015, 1100015, 1100015, 1100…\n#&gt; $ sex               &lt;fct&gt; male, male, male, male, male, male, male, male, m…\n#&gt; $ age               &lt;int&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,…\n#&gt; $ population        &lt;int&gt; 148, 150, 154, 159, 163, 169, 177, 177, 172, 174,…"
  },
  {
    "objectID": "index.html#create-data-dictionary",
    "href": "index.html#create-data-dictionary",
    "title": "",
    "section": "Create Data Dictionary",
    "text": "Create Data Dictionary\nPrepare Metadata\n\nmetadata &lt;-\n  data |&gt;\n  `var_label&lt;-`(\n    list(\n      year = \"Year of the population estimate\",\n      municipality_code = \"IBGE municipality code\",\n      sex = \"Sex of the population\",\n      age = \"Age of the population\",\n      population = \"Population estimate\"\n    )\n  ) |&gt;\n  generate_dictionary(details = \"full\") |&gt;\n  convert_list_columns_to_character()\n\nVisualize Final Data\n\nmetadata |&gt; glimpse()\n#&gt; Rows: 5\n#&gt; Columns: 14\n#&gt; $ pos           &lt;int&gt; 1, 2, 3, 4, 5\n#&gt; $ variable      &lt;chr&gt; \"year\", \"municipality_code\", \"sex\", \"age\", \"populatio…\n#&gt; $ label         &lt;chr&gt; \"Year of the population estimate\", \"IBGE municipality…\n#&gt; $ col_type      &lt;chr&gt; \"int\", \"int\", \"fct\", \"int\", \"int\"\n#&gt; $ missing       &lt;int&gt; 0, 0, 0, 0, 0\n#&gt; $ levels        &lt;chr&gt; \"\", \"\", \"male; female\", \"\", \"\"\n#&gt; $ value_labels  &lt;chr&gt; \"\", \"\", \"\", \"\", \"\"\n#&gt; $ class         &lt;chr&gt; \"integer\", \"integer\", \"factor\", \"integer\", \"integer\"\n#&gt; $ type          &lt;chr&gt; \"integer\", \"integer\", \"integer\", \"integer\", \"integer\"\n#&gt; $ na_values     &lt;chr&gt; \"\", \"\", \"\", \"\", \"\"\n#&gt; $ na_range      &lt;chr&gt; \"\", \"\", \"\", \"\", \"\"\n#&gt; $ n_na          &lt;int&gt; 0, 0, 0, 0, 0\n#&gt; $ unique_values &lt;int&gt; 1, 5571, 2, 81, 7982\n#&gt; $ range         &lt;chr&gt; \"2025 - 2025\", \"1100015 - 5300108\", \"\", \"0 - 80\", \"1 …\n\n\nmetadata\n\n\n  \n\n\n\n\ndata |&gt; glimpse()\n#&gt; Rows: 902,502\n#&gt; Columns: 5\n#&gt; $ year              &lt;int&gt; 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2025, 2…\n#&gt; $ municipality_code &lt;int&gt; 1100015, 1100015, 1100015, 1100015, 1100015, 1100…\n#&gt; $ sex               &lt;fct&gt; male, male, male, male, male, male, male, male, m…\n#&gt; $ age               &lt;int&gt; 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14,…\n#&gt; $ population        &lt;int&gt; 148, 150, 154, 159, 163, 169, 177, 177, 172, 174,…\n\n\ndata"
  },
  {
    "objectID": "index.html#save-data",
    "href": "index.html#save-data",
    "title": "",
    "section": "Save Data",
    "text": "Save Data\n\n\n\n\n\n\nThe processed data are available in csv, rds and parquet formats through a dedicated repository on the Open Science Framework (OSF). See the Data Availability section for more information.\n\n\n\nWrite Data\n\nvalid_file_pattern &lt;- year\n\n\ndata |&gt;\n  write_csv(\n    here(data_dir, paste0(valid_file_pattern, \".csv\"))\n  )\n\n\ndata |&gt;\n  write_rds(\n    here(data_dir, paste0(valid_file_pattern, \".rds\"))\n  )\n\n\ndata |&gt;\n  write_parquet(\n    here(data_dir, paste0(valid_file_pattern, \".parquet\"))\n  )\n\nWrite Metadata\n\nmetadata_file_pattern &lt;-\n  \"metadata-\" |&gt;\n  paste0(year)\n\n\nmetadata |&gt;\n  write_csv(\n    here(data_dir, paste0(metadata_file_pattern, \".csv\"))\n  )\n\n\nmetadata |&gt;\n  write_rds(\n    here(data_dir, paste0(metadata_file_pattern, \".rds\"))\n  )\n\n\nmetadata |&gt;\n  write_parquet(\n    here(data_dir, paste0(metadata_file_pattern, \".parquet\"))\n  )"
  },
  {
    "objectID": "index.html#visualize-data",
    "href": "index.html#visualize-data",
    "title": "",
    "section": "Visualize Data",
    "text": "Visualize Data\nPlot Histogram by Municipality\n\ndata |&gt;\n  summarize(\n    population = sum(population, na.rm = TRUE),\n    .by = \"municipality_code\"\n  ) |&gt;\n  ggplot(aes(x = population)) +\n  geom_histogram(\n    aes(y = after_stat(density)),\n    bins = 30,\n    fill = get_brand_color(\"gray-d25\"),\n    color = get_brand_color(\"white\")\n  ) +\n  geom_density(\n    color = \"red\",\n    linewidth = 1\n  ) +\n  scale_x_continuous(\n    transform = \"log10\"\n  ) +\n  labs(\n    title = \"Population Estimates by Municipality in Brazil\",\n    subtitle = paste0(\"Year: \", year),\n    x = \"Population Estimate\",\n    y = \"Density\",\n    caption = \"Source: DATASUS/IBGE.\"\n  )\n\n\n\n\n\n\n\nPlot Map by Municipality\nSet Shape\n\nshape &lt;-\n  read_municipality(\n    year = year |&gt;\n      closest_geobr_year(type = \"municipality\"),\n    showProgress = FALSE\n  ) |&gt;\n  st_transform(st_crs(4326))\n#&gt; ! The closest map year to 2025 is 2024. Using year 2024 instead.\n#&gt; Using year/date 2024\n\nPrepare Plot Data\n\nplot_data &lt;-\n  data |&gt;\n  summarize(\n    population = sum(population, na.rm = TRUE),\n    .by = \"municipality_code\"\n  ) |&gt;\n  left_join(\n    shape,\n    by = join_by(municipality_code == code_muni)\n  ) |&gt;\n  rename(geometry = geom) |&gt;\n  select(\n    municipality_code,\n    population,\n    geometry\n  ) |&gt;\n  drop_na(population)\n\nPlot Data\n\nbrand_div_palette &lt;- function(x) {\n  brandr:::make_color_ramp(\n    n = x,\n    colors = c(\n      get_brand_color(\"dark-red\"),\n      # get_brand_color(\"white\"),\n      get_brand_color_mix(\n        position = 950,\n        color_1 = \"dark-red\",\n        color_2 = \"dark-red-triadic-blue\",\n        alpha = 0.5\n      ),\n      get_brand_color(\"dark-red-triadic-blue\")\n    )\n  )\n}\n\n\nplot_data |&gt;\n  st_as_sf() |&gt;\n  ggplot(aes(fill = population)) +\n  geom_sf(\n    color = get_brand_color(\"gray\"),\n    linewidth = 0.05\n  ) +\n  scale_fill_binned(\n    palette = brand_div_palette,\n    na.value = get_brand_color(\"gray-d25\"),\n    transform = \"log10\"\n  ) +\n  annotation_scale(\n    aes(),\n    location = \"br\",\n    style = \"tick\",\n    height = unit(0.5, \"lines\")\n  ) +\n  annotation_north_arrow(\n    location = \"br\",\n    height = unit(2, \"lines\"),\n    width = unit(2, \"lines\"),\n    pad_x = unit(0.25, \"lines\"),\n    pad_y = unit(1.25, \"lines\"),\n    style = north_arrow_fancy_orienteering\n  ) +\n  labs(\n    title = \"Population Estimates by Municipality in Brazil\",\n    subtitle = paste0(\"Year: \", year),\n    fill = NULL,\n    caption = \"Source: DATASUS/IBGE.\"\n  )\n#&gt; Scale on map varies by more than 10%, scale bar may be inaccurate"
  },
  {
    "objectID": "index.html#citation",
    "href": "index.html#citation",
    "title": "",
    "section": "Citation",
    "text": "Citation\n\n\n\n\n\n\nWhen using this data, you must also cite the original data sources.\n\n\n\nTo cite this work, please use the following format:\nVartanian, D., & Carvalho, A. M. (2025). A reproducible pipeline for processing DATASUS annual population estimates by municipality, age, and sex in Brazil [Computer software]. Sustentarea Research and Extension Group, University of São Paulo. https://sustentarea.github.io/population-estimates\nA BibLaTeX entry for LaTeX users is:\n@software{vartanian2025,\n  title = {A reproducible pipeline for processing DATASUS annual population estimates by municipality, age, and sex in Brazil},\n  author = {{Daniel Vartanian} and {Aline Martins de Carvalho}},\n  year = {2025},\n  address = {São Paulo},\n  institution = {Sustentarea Research and Extension Group, the University of São Paulo},\n  langid = {en},\n  url = {https://sustentarea.github.io/population-estimates}\n}"
  },
  {
    "objectID": "index.html#license",
    "href": "index.html#license",
    "title": "",
    "section": "License",
    "text": "License\n \n\n\n\n\n\n\nThe original data sources may be subject to their own licensing terms and conditions.\n\n\n\nThe code in this repository is licensed under the GNU General Public License Version 3, while the report is available under the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International.\nCopyright (C) 2025 Sustentarea Research and Extension Group\n\nThe code in this report is free software: you can redistribute it and/or\nmodify it under the terms of the GNU General Public License as published by the\nFree Software Foundation, either version 3 of the License, or (at your option)\nany later version.\n\nThis program is distributed in the hope that it will be useful, but WITHOUT ANY\nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A\nPARTICULAR PURPOSE. See the GNU General Public License for more details.\n\nYou should have received a copy of the GNU General Public License along with\nthis program. If not, see &lt;https://www.gnu.org/licenses/&gt;."
  },
  {
    "objectID": "index.html#acknowledgments",
    "href": "index.html#acknowledgments",
    "title": "",
    "section": "Acknowledgments",
    "text": "Acknowledgments\n\n\n\n\n\nThis work is part of a research project by the Sustentarea Research and Extension Group of the University of São Paulo (USP) titled: Global syndemic: The impact of anthropogenic climate change on the health and nutrition of children under five years old attended by Brazil's public health system.\n\n\n\n\n\n\nThis work was supported by the Department of Science and Technology of the Secretariat of Science, Technology, and Innovation and of the Health Economic-Industrial Complex (SECTICS) of the Ministry of Health of Brazil, and the National Council for Scientific and Technological Development (CNPq) (grant no. 444588/2023-0)."
  },
  {
    "objectID": "index.html#references",
    "href": "index.html#references",
    "title": "",
    "section": "References",
    "text": "References\n\n\nAllaire, J. J., Teague, C., Xie, Y., & Dervieux, C. (n.d.). Quarto [Computer software]. Zenodo. https://doi.org/10.5281/ZENODO.5960048\n\n\nComitê de Gestão de Indicadores, Rede Interagencial de Informações para a Saúde, Coordenação-Geral de Informações e Análises Epidemiológicas, Secretaria de Vigilância em Saúde e Ambiente, Ministério da Saúde, & Instituto Brasileiro de Geografia e Estatística. (n.d.). População residente – Estudo de estimativas populacionais por município, idade e sexo 2000-2024 – Brasil [Resident population – Study of population estimates by municipality, age, and sex, 2000–2024 – Brazil] [Data set]. DATASUS - Tabnet. Retrieved November 16, 2023, from http://tabnet.datasus.gov.br/cgi/deftohtm.exe?ibge/cnv/popsvs2024br.def\n\n\nR Core Team. (n.d.). R: A language and environment for statistical computing [Computer software]. R Foundation for Statistical Computing. https://www.R-project.org\n\n\nUshey, K., & Wickham, H. (n.d.). renv: Project environments [Computer software]. https://doi.org/10.32614/CRAN.package.renv\n\n\nWickham, H. (n.d.-a). The tidyverse style guide. Retrieved July 17, 2023, from https://style.tidyverse.org\n\n\nWickham, H. (n.d.-b). Tidy design principles. https://design.tidyverse.org\n\n\nWickham, H. (2023). The tidy tools manifesto. Tidyverse. https://tidyverse.tidyverse.org/articles/manifesto.html\n\n\nWickham, H., Çetinkaya-Rundel, M., & Grolemund, G. (2023). R for data science: Import, tidy, transform, visualize, and model data (2nd ed.). O’Reilly Media. https://r4ds.hadley.nz"
  }
]